drop table IF EXISTS users, categories, locations, events, requests, compilations, compilation_events;

CREATE TABLE if NOT EXISTS users (
id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(255) NOT NULL,
email VARCHAR(512) NOT NULL UNIQUE
);

CREATE TABLE if NOT EXISTS categories (
id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS locations (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	lat VARCHAR NOT NULL,
	lon VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS events (
	event_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	annotation VARCHAR NOT NULL,
	category BIGINT REFERENCES categories(id) ON DELETE RESTRICT,
	created_on TIMESTAMP,
	description VARCHAR NOT NULL,
	event_date TIMESTAMP,
	initiator BIGINT REFERENCES users(id) ON DELETE CASCADE,
	location BIGINT REFERENCES locations (id) ON DELETE CASCADE,
	paid BOOLEAN NOT NULL,
	participants_limit BIGINT,
	published_on TIMESTAMP,
	request_moderation BOOLEAN NOT NULL,
	state VARCHAR,
	title VARCHAR NOT NULL
);

CREATE TABLE if NOT EXISTS requests (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
created TIMESTAMP NOT NULL,
event bigint REFERENCES events (id) ON DELETE CASCADE,
requester bigint REFERENCES users (id) ON DELETE CASCADE,
status VARCHAR
);

CREATE TABLE IF NOT EXISTS compilations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR NOT NULL UNIQUE,
    pinned BOOLEAN NOT NULL
);

CREATE TABLE IF NOT EXISTS compilation_events (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    event_id BIGINT NOT NULL REFERENCES events(id) ON DELETE CASCADE,
    compilation_id BIGINT NOT NULL REFERENCES compilations(id) ON DELETE CASCADE
);